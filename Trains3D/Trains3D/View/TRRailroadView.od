import EGGL
import TRRailroad
import EGModel
import "TR3DRail.h"
import "TR3DRailTurn.h"
import TRTypes

class TRRailroadView {
    private val railView = TRRailView

    def draw(railroad : TRRailroad) {
        railroad.rails.for(railView.draw(_))
        railroad.builder.rail.for(railView.draw(_))
    }
}

stub val Rail : string
stub val RailTurn : string

class TRRailView {
    def draw(rail : TRRail) {
        glPushMatrix
        glTranslatef(rail.tile.x, rail.tile.y, 0.001)

        glColor3f(0.2, 0.2, 0.2)

        if(rail.form == TRRailForm.bottomTop) {
            glRotatef(90, 1, 0, 0)
            egDrawJasModel(Rail)
        } else if(rail.form == TRRailForm.leftRight) {
            glRotatef(90, 0, 0, 1)
            glRotatef(90, 1, 0, 0)
            egDrawJasModel(Rail)
        } else {
            if(rail.form.start.x == 0 && rail.form.start.y == 1) glRotatef(90, 0, 0, 1)
            else if(rail.form.start.x == -1 && rail.form.end.y == 1) glRotatef(180, 0, 0, 1)
            else if(rail.form.start.x == -1 && rail.form.end.y == -1) glRotatef(270, 0, 0, 1)
            glRotatef(90, 1, 0, 0)
            egDrawJasModel(RailTurn)
        }
        glPopMatrix
    }
}