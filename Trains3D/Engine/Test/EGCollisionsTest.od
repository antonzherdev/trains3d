package com.antonzherdev.eg

import test._

class EGCollisionsTest extends CNTestCase {
    def testDavidsStar {
        val figures = [
            (1, EGPolygon([EGVec2(1, 0), EGVec2(3, 2), EGVec2(5, 0)])),
            (2, EGPolygon([EGVec2(1, 1), EGVec2(5, 1), EGVec2(3, -1)])),
            (3, EGPolygon([EGVec2(4, -1), EGVec2(4.5, -0.5), EGVec2(5, -1)]))
        ]
        val collisions = EGCollisions.collisionsFor(figures)
        assertEquals(collisions, [EGCollision(CNPair(1, 2), [
            EGVec2(1.5, 0.5), EGVec2(2, 0), EGVec2(2, 1),
            EGVec2(4.5, 0.5), EGVec2(4, 0), EGVec2(4, 1)
        ].toSet)].toSet)
    }

    def testEmptyWithCrossedBoundingRects {
        val figures = [
            (1, EGPolygon([EGVec2(1, 0), EGVec2(3, 2), EGVec2(5, 0)])),
            (3, EGPolygon([EGVec2(4, -1), EGVec2(4.5, -0.5), EGVec2(5, -1)]))
        ]
        val collisions = EGCollisions.collisionsFor(figures)
        assertEquals(collisions, [].toSet)
    }

    def testEmptyWithoutCrossedBoundingRects {
        val figures = [
            (1, EGPolygon([EGVec2(1, 0), EGVec2(3, 2), EGVec2(5, 0)])),
            (3, EGPolygon([EGVec2(6, -1), EGVec2(6.5, -0.5), EGVec2(7, -1)]))
        ]
        val collisions = EGCollisions.collisionsFor(figures)
        assertEquals(collisions, [].toSet)
    }

    def testCollisions2 {
        val world = EGCollisionWorld<int>()
        val box1 = EGCollisionBody<int>(1, EGCollisionBox(1, 1, 1), isKinematic = true)
        val box2 = EGCollisionBody<int>(2, EGCollisionBox(1, 1, 1), isKinematic = false)
        world.add(box1)
        world.add(box2)
        box1.translate(0.8, 0.8, 0)
        assertTrue(world.detect.count == 1)
        box1.translate(0.1, 0.1, 0)
        assertTrue(world.detect.count == 1)

        box1.translate(0.2, 0.2, 0)
        assertTrue(world.detect.isEmpty)
//        box1.set(matrix = box1.matrix.tra)
    }
}
