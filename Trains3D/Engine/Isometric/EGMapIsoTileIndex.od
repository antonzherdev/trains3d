import EGTypes
import EGMapIso
import CNCollection

class EGMapSsoTileIndex<T>(map : EGMapSso, initial : () -> T) {
    private val index = CNMutableHashMap.new<int, T>
    private val wh = map.size.width + map.size.height + 1

    private def numberFor(tile : EGPointI) : int = (tile.x + tile.y)*wh + tile.y - tile.x

    def apply(tile : EGPointI) : T = index.objectFor(numberFor(tile), orUpdateWith = initial)
    def values : CNIterable<T> = index.values
}